---
title: "uva.rmd"
output: html_document
date: "2025-04-04"
---

```{r}
library(dplyr)
library(tidyverse)
library(leaflet)
library(lubridate)
library(sf)
library(leaflet.extras)
library(readr)
df <- read_csv("~/Downloads/Transit_2020.csv")
```

```{r}
df <- read.csv("~/Downloads/Transit_2020.csv")

df$FareCategory <- ifelse(grepl("UVA", df$FareCategory), "UVA", "Non-UVA")

# Step 2: Classify stops based on whether they EVER had a UVA fare
stop_type <- df %>%
  group_by(Stop) %>%
  summarise(StopType = ifelse(any(FareCategory == "UVA"), "UVA Stop", "Non-UVA Stop"))

# Step 3: Join back into original data
df <- df %>%
  left_join(stop_type, by = "Stop")

# Step 2: Create time features
df <- df %>%
  mutate(Date_Time = ymd_hms(Date_Time),
         Hour = hour(Date_Time),
         Date = as.Date(Date_Time))

# Step 3: Filter to weekdays
df_weekdays <- df %>%
  filter(wday(Date_Time) %in% 2:6)

# Step 4: Total ridership per hour per day per StopType
hourly_totals <- df_weekdays %>%
  group_by(StopType, Date, Hour) %>%
  summarise(Daily_Total_Ridership = sum(Count, na.rm = TRUE), .groups = "drop")

# Step 5: Average ridership per hour per StopType
hourly_avg <- hourly_totals %>%
  group_by(StopType, Hour) %>%
  summarise(Average_Ridership = mean(Daily_Total_Ridership, na.rm = TRUE), .groups = "drop")
```

```{r}
ggplot(filter(hourly_avg, StopType == "UVA Stop"),
       aes(x = Hour, y = Average_Ridership)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(title = "Weekday Average Ridership per Hour â€“ UVA Stops",
       x = "Hour of the Day", y = "Average Ridership per Hour") +
  theme_classic() +
  scale_x_continuous(breaks = seq(0, 23, 1))
```
